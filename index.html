<!doctype html>
<html lang="en">
  <head>
      <title>H1b Employer Search</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://use.fontawesome.com/104d5d81ec.js"></script>
  </head>
  <style>
      @media only screen and (min-width: 993px)
      {
            .container {
                width: 80%;
            }
      }

      .page-footer {
        margin-top: 2% !important;
        color: #fff;
        background-color: #ee6e73;
        padding:0;
      }

     .input-width-14 {
         width: 14% !important;
     }

      #job_title {
            position: relative;
            top: 8px;
        }

        .input-width {
            width: 20%;
        }

        table {
            border: solid 1px #aaa !important;
            /*cursor: pointer;*/
        }

        thead {
            background-color: lightgray;
        }

        tbody {
            font-size: 13px;
        }

        .search-btn {
            margin-top: 2.5%;
        }

        .required-field {
            color: red;
            font-weight: bold;
        }

        .hide {
            display: none;
        }

        nav {
            margin-bottom: 2%;
        }

        nav .nav-wrapper {
           margin: 0 auto;
        }

        .facebook-icon {
            background-color: #3b5998 !important;
        }

        .twitter-icon {
            background-color: #00abe3 !important;
        }

  </style>
  <body>

    <nav>
        <div class="nav-wrapper">
            <a href="#" class="brand-logo">H1b Employer Search</a>
        </div>
    </nav>
    
    <div class="fixed-action-btn">
            <a class="btn-floating btn-large red">
              <i class="large material-icons">share</i>
            </a>
            <ul>
              <li><a class="btn-floating facebook-icon" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A//medium.com/%40swarnakishore/deploying-angular-cli-project-to-github-pages-db49246598a1"><span class="fa fa-facebook"></span></a></li>
              <li><a class="btn-floating twitter-icon" target = "_blank" href="https://twitter.com/home?status=Check%20out%20article%20https%3A//medium.com/%40swarnakishore/deploying-angular-cli-project-to-github-pages-db49246598a1%20via%20%40Swarna_Kishoree"><span class="fa fa-twitter"></span></a></li>
            </ul>
    </div>


    <div class="container">
        <div class="row">
            <div class="input-field col s3 input-width-14">
                <select onchange="onSearcByCriteriaChange(value)"> 
                    <option value="Location">Location</option>
                    <option value="Employer">Employer</option>
                </select>
                <label>Search By</label>
            </div>
            <div id="miles_from_div" class="input-field col s3 input-width-14">
                <!-- <input id="miles_from" type="text" class="validate"  required="" aria-required="true" oninput="onMilesFromInput(miles_from.value)">
                <label for="miles_from"><span class="required-field">*</span>Miles From</label>
                <span class="helper-text" data-error="Please enter miles"></span> -->
                <select required id="miles_from" onchange="onMilesFromInput(value)"> 
                        <option value="5">5</option>
                        <option value="15">25</option>
                        <option value="15">50</option>
                        <option value="15">75</option>
                        <option value="15">100</option>
                        <option value="15">125</option>
                </select>
                <label>Miles from</label>
            </div>
            <div id="zip_code_div" class="input-field col s3 input-width-14">
                <input id="zip_code" type="number" class="validate" required="" aria-required="true"  oninput="onZipCodeInput(zip_code.value)">
                <label for="zip_code"><span class="required-field">*</span>Zip Code</label>
                <span class="helper-text" data-error="Please enter zip code"></span>
            </div>
            <div id="employer_div" class="input-field col s3 hide input-width">
                <input id="employer_name" type="text" class="validate autocomplete" required="" aria-required="true" oninput="onEmployerInput(employer_name.value)">
                <label for="employer_name"><span class="required-field">*</span>Enter Employer Name</label>
                <span class="helper-text" data-error="Please enter employer name"></span>
            </div>

            <div class=" center-align search-btn col s3">
                <button class="btn waves-effect waves-light" type="submit" name="action" onclick="onSubmit()">Search
                    <i class="material-icons right">send</i>
                </button>
            </div>
        </div>

        <div class="row">
            <div class="col s3">
                <form action="#">
                    <p>Salary Greater Than</p>
                    <p class="range-field">
                        <input type="range" id="salary" min="60" max="500" onchange="onSalaryInput(salary.value)">
                    </p>
                </form>
            </div>
            <div class="col s3 input-field input-width-14">
                    <!-- <form action="#">
                        <p>Year After</p>
                        <p class="range-field">
                            <input type="range" id="year" min="2010" max="2019" onchange="onYearInput(year.value)">
                        </p>
                    </form> -->
                    <select id="year" onchange="onYearInput(value)"> 
                            <option value="2010">2010</option>
                            <option value="2011">2011</option>
                            <option value="2010">2012</option>
                            <option value="2011">2013</option>
                            <option value="2010">2014</option>
                            <option value="2011">2015</option>
                            <option value="2010">2016</option>
                            <option value="2011">2017</option>
                            <option value="2010">2018</option>
                            <option value="2011">2019</option>
                        </select>
                    <label>Year After</label>
                </div>
            <div class="input-field col s2">
                <input id="job_title" type="text" class="validate" oninput="onJobTitleInput(job_title.value)">
                <label for="job_title">Job Title</label>
            </div>
            <div class="switch col s2">
                    <label>
                        Exclude H1 Dependent
                        <input type="checkbox" id="switch_1" onchange="onSwitch(switch_1.value)">
                        <span class="lever"></span>
                    </label>
                </div>
        </div>

        <!-- <div class="row">
            <div class="switch col s4">
                <label>
                    Off
                    <input type="checkbox" id="switch_1" onchange="onSwitch(switch_1.value)">
                    <span class="lever"></span>
                    On
                </label>
            </div>
            <div class="switch col s4">
                <label>
                    Off
                    <input type="checkbox" id="switch_2">
                    <span class="lever"></span>
                    On
                </label>
            </div>
            <div class="switch col s4">
                <label>
                    Off
                    <input type="checkbox" id="switch_3">
                    <span class="lever"></span>
                    On
                </label>
            </div>
        </div> -->

        <!--table-->
        <table id='table-list' class="responsive-table highlight">
            <thead>
                <!-- <tr>
                    <th>Employer</th>
                    <th>Job</th>
                    <th>Date</th>
                    <th>Salary</th>
                    <th>Location</th>
                </tr> -->
            </thead>
        
            <tbody>
                <!-- <tr class="modal-trigger" data-target="modal1"> -->
                
            </tbody>
        </table>
    
        <ul id="paginator" class="pagination center-align">
            <!-- <li id='left' class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
            <li class="active"><a href="#!">1</a></li>
            <li class="waves-effect"><a href="#!">2</a></li>
            <li class="waves-effect"><a href="#!">3</a></li>
            <li class="waves-effect"><a href="#!">4</a></li>
            <li class="waves-effect"><a href="#!">5</a></li> -->
            
        </ul>
    </div>

    <!--footer-->
    <footer class="page-footer">
        <div class="footer-copyright">
                <div class="container">Â© <span id="current-year"></span> All rights reserved.</div>
        </div>
    </footer>

    <!-- Modal Structure -->
    <div id="modal1" class="modal">
        <div id='modal1-content' class="modal-content">
        </div>
        <div class="modal-footer">
        <a href="#!" class="modal-close waves-effect waves-green btn-flat">OK</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
        var g_lcaData = []
        var g_pageNumber = 1
        var g_pageRows = 15
        var g_pagingLimit = 10
        var g_isAutoCompleteInProgress = false
        var date = new Date()

        $(document).ready(function(){
                $('select').formSelect();
                $('.modal').modal();
                $('.fixed-action-btn').floatingActionButton();
                document.getElementById("current-year").innerHTML = date.getFullYear();
            });

            $('#table-list').hide();
            $('#paginator').hide();


            function showData(){
                if (g_lcaData.length == 0)
                {
                    $('#table-list').hide();
                    $('#paginator').hide()

                    return
                }
                buildPaging()
                $('#table-list').show();
                $('#paginator').show()

                showPageData()

            }

            function showPageData(){
                var tableRowsHtml = '<thead><tr><th>Employer</th><th>Job</th><th>Date</th><th>Salary</th><th>Location</th></tr></thead><tbody>'
                var l = g_lcaData.length
                if (l > g_pageRows * g_pageNumber) {
                    l = g_pageRows * g_pageNumber;
                }
                var i = (g_pageNumber - 1) * g_pageRows
                for (; i<l; i++){
                     /* add this to tr tag to make it modal -  onclick="prepareModal('+i+'); return false;" class="modal-trigger" data-target="modal1">*/
                    tableRowsHtml = tableRowsHtml+ '<tr><td>'+ g_lcaData[i].Employer_name +'</td><td>'
                        + g_lcaData[i].Job_title + '</td><td>'+ g_lcaData[i].Start_date.split('T')[0]+'</td><td>'
                        +g_lcaData[i].Wage_rate+'</td><td>' +g_lcaData[i].Employer_city+', '+g_lcaData[i].Employer_state+'</td></tr>'
                }
                tableRowsHtml = tableRowsHtml + '</tbody>'
                $('#table-list').html(tableRowsHtml);

            }

            function prepareModal(i){
                var lca = g_lcaData[i]
                $('#modal1-content').html('<h4>'+lca.Employer_name+' '+ lca.Employer_city+', '+lca.Employer_state
                    +'</h4><p>Job: '+lca.Job_title +(lca.Full_time=='Y'?'(full time)':'')+'</p><p>Start date: '+lca.Start_date.split('T')[0]+'</p>'
                    +'<p>Work location: '+lca.Work_location_city+', '+ lca.Work_location_state+'</p>')
            }

            function changePage(num){
                g_pageNumber = num
                buildPaging()
                showPageData()
            }

            function buildPaging(){
                var pages = Math.floor(g_lcaData.length/g_pageRows)
                if (g_lcaData.length%g_pageRows != 0){
                    pages++
                }
                var showUntil = g_pageNumber + g_pagingLimit
                if (showUntil > pages){
                    showUntil = pages
                }

                var showFrom = g_pageNumber
                if (showFrom>pages-g_pagingLimit){
                    showFrom = pages-g_pagingLimit
                }

                var pagingHtml = '<li id="left" class="' +(g_pageNumber <= 1 ? "hide" : "show")+ '"><a href="#!" onclick="changePage('+ (1*1) +'); return false;"<i class="material-icons">first_page</i></a></li>'
                pagingHtml = pagingHtml + '<li id="left" class="' +(g_pageNumber == 1 ? "disabled" : "")+ '"><a href="#!" onclick="changePage('+ (g_pageNumber-1) +'); return false;"<i class="material-icons">chevron_left</i></a></li>'
                for (var i=showFrom;i<=showUntil;i++)
                {
                    pagingHtml = pagingHtml + '<li class="waves-effect ' +(i == g_pageNumber ? 'active' : '')+ '"><a href="#!" onclick="changePage('+i+'); return false;">'+ i +'</a></li>'
                }   
                if (showUntil < pages) {
                    pagingHtml = pagingHtml + '<li id="right" class="waves-effect" class="' +(g_pageNumber == pages ? "disabled" : "")+ '"><a href="#!" onclick="changePage('+ (g_pageNumber+1) +'); return false;"><i class="material-icons">chevron_right</i></a></li>'
                    pagingHtml = pagingHtml + '<li id="right" class="waves-effect" class="' +(g_pageNumber == pages ? "hide" : "show")+ '"><a href="#!" onclick="changePage('+ (pages*1) +'); return false;"><i class="material-icons">last_page</i></a></li>'
                }
                $('#paginator').html(pagingHtml)
            }

            function onSearcByCriteriaChange(value) {
                var employerElement = document.getElementById("employer_div");
                $('#employer_name').val('')
                employerElement.classList.toggle("hide");

                var milesFromElement = document.getElementById("miles_from_div");
                $('#miles_from').val('')
                milesFromElement.classList.toggle("hide");

                var zipCodeElement = document.getElementById("zip_code_div");
                $('#zip_code').val('')
                zipCodeElement.classList.toggle("hide");
            }

            function onSubmit() {
                //get url and hit /lca with r z or e
                var q = '?'
                var employerElement = document.getElementById("employer_name");
                var emp = employerElement.value;

                var milesFromElement = document.getElementById("miles_from");
                var miles = milesFromElement.value;

                var zipCodeElement = document.getElementById("zip_code");
                var zip = zipCodeElement.value;
                
                if (emp.length>0){
                    q = q+'e='+emp
                } else if(zip.length > 0){
                    q = q+'r='+miles+'&z='+zip
                }



                $.get( "/lca"+q, function(d) {
                    if (!d || d.length == 0)
                     return;

                     g_lcaData = d;
                     g_pageNumber = 1
                    showData()
                });
            }

            function onEmployerInput(employer) {
              
            }

            var typingTimer;                //timer identifier
            var doneTypingInterval = 2000;  //time in ms, 5 second for example
            var $input = $('#employer_name');
            //on keyup, start the countdown
            $input.on('keyup', function () {
                clearTimeout(typingTimer);
                typingTimer = setTimeout(doneTyping, doneTypingInterval);
            });

            //on keydown, clear the countdown 
            $input.on('keydown', function () {
                clearTimeout(typingTimer);
            });

            //user is "finished typing," do something
            function doneTyping () {
                var employerElement = $('#employer_name');
                var emp = employerElement.val();
                if(emp.length >= 0){
                    $.get( "/emps?has="+emp, function(d) {
                        employerElement.autocomplete({data:d});
                    });
                }
            }

            function onMilesFromInput(miles) {
                console.log(miles);
            }

            function onZipCodeInput(zipCode) {
                console.log(zipCode);
            }

            function onSalaryRangeInput(range) {
                console.log(range);
            }

            function onJobTitleInput(title) {
                console.log(title);
            }

            function onSwitch(value) {
                console.log(value);
            }
    </script>
  </body>
</html>